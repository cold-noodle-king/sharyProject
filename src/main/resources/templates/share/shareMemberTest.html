<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>공유멤버 테스트</title>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:inline="javascript">
        $(document).ready(function (){
            $('.joinBtn').on('click', function (){
                let diaryNum = $(this).data('diary-num');
                console.log(diaryNum);

                if (!confirm('가입 요청하시겠습니까?')){
                    return false;
                } else {
                    // AJAX 요청 보내기
                    $.ajax({
                        type: 'GET',
                        url: '/sharemember/join',
                        data: { diaryNum: diaryNum },
                        success: function(response) {
                            // 서버로부터 받은 msg 값으로 alert 창 띄우기
                            if (response) {
                                alert(response);
                            }
                        },
                        error: function(error) {
                            console.log("에러 발생:", error);
                        }
                    });
                }

            });

        });
    </script>

</head>
<body>
    <div>
        <table>
            <tr th:each="diary : ${diaryList}">
                <td th:text="${diary.shareDiaryNum}"></td>
                <td th:text="${diary.shareDiaryName}"></td>
                <td th:text="${diary.memberId}"></td>
                <td th:text="${diary.diaryBio}"></td>
                <td>
                    <span th:if="${#authentication.name} != ${diary.memberId}">
                        <button class="joinBtn" th:attr="data-diary-num=${diary.shareDiaryNum}">가입</button>
                    </span>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>