<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>쪽지 보내기</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        h1, h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .message-form {
            margin-bottom: 20px;
        }

        .message-form p {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-form label {
            font-weight: bold;
        }

        .message-form input[type="text"] {
            width: 60%; /* 더 좁게 */
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .message-form button {
            background-color: white; /* 흰색 배경 */
            color: #5dade2; /* 텍스트 색상 */
            border: 1px solid #5dade2; /* 테두리 추가 */
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-left: 10px; /* 버튼과 입력란 사이 여백 추가 */
        }

        .message-form button:hover {
            background-color: #f0f0f0; /* 호버 시 배경색 변화 */
        }

        /* 쪽지함 버튼 */
        .message-box {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .message-box a {
            display: inline-block;
            background-color: #5dade2;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 20px;
            text-decoration: none;
            font-weight: bold;
            margin-left: 10px; /* 왼쪽 여백 추가 */
        }

        .message-box a:hover {
            background-color: #3498db;
        }
    </style>


    <script src="/js/jquery-3.7.1.min.js"></script>

<!--    <script>
        $(document).ready(function() {

            // 보내기 버튼 클릭하면 전송
            $('#sendButton').click(sendTest);

            // 메시지 입력하다 엔터치는 경우에도 전송
            $('#msg').keydown(function(event) {
                if (event.key === 'Enter' || event.keyCode === 13) {
                    sendTest();
                }
            });

            // 알림 데이터를 담을 배열
            let notifications = [];

            // SSE 연결 설정
            const eventSource = new EventSource("/subscribe");

            // SSE 이벤트 처리
            eventSource.addEventListener('notification', function(event) {
                let data = JSON.parse(event.data);
                addNotificationItem(data);
            });
addNotificationItem
            function addNotificationItem(item) {
                notifications.push(item);

                // 알림 표시
                displayNotifications();
            }

            function displayNotifications() {
                let notificationDiv = $('#notificationDiv');
                notificationDiv.empty();

                notifications.forEach(item => {
                    let formattedDate = new Date(item.createdAt).toLocaleString();
                    let html = `
                    <div class="notification">
                        <div class="content">
                            <div class="text">${item.content}</div>
                            <div class="time">${formattedDate}</div>
                        </div>
                    </div>`;
                    notificationDiv.append(html);
                });
            }
        });

        function sendTest() {
            let id = $('#id').val();
            let msg = $('#msg').val();

            if (id == '' || msg == '') {
                alert('수신인 아이디와 메시지 내용을 입력하세요.');
                return;
            }

            $.ajax({
                url : 'send',
                type: 'post',
                data : {memberId : id, message : msg},
                success : function () {
                    $('#msg').val('');
                    console.log('전송완료');
                },
                error : function (err) {
                    console.log(JSON.stringify(err));
                }
            });
        }
    </script>-->
    <script src="/js/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#sendButton').click(function() {
                let id = $('#id').val();
                let msg = $('#msg').val();

                if (id === '' || msg === '') {
                    alert('수신자 아이디와 메시지 내용을 입력하세요.');
                    return;
                }

                $.ajax({
                    url: '/send',
                    type: 'post',
                    data: { memberId: id, message: msg },
                    success: function () {
                        $('#msg').val('');
                        console.log('쪽지 전송 완료');
                    },
                    error: function (err) {
                        console.log('오류 발생: ' + JSON.stringify(err));
                    }
                });
            });
        });
    </script>
</head>
<body>
<!--<p sec:authorize="isAuthenticated()"><a href="/msgTest">알림함</a></p>-->
<!--<h2>쪽지</h2>
<p>* 이곳에서 아이디와 쪽지내용을 입력하여 로그인된 사용자에게 메시지를 보낸다.</p>-->
<div class="container">
    <h1>[ 쪽지 보내기 ]</h1>

    <div class="message-form">
        <p>
            <input type="text" id="id" placeholder="수신자 아이디를 입력하세요">
        </p>
        <p>
            <input type="text" id="msg" placeholder="쪽지 내용을 입력하세요">
            <button id="sendButton">보내기</button>
        </p>
    </div>

    <!-- 쪽지함 버튼 -->
    <div class="message-box">
        <a href="/message" sec:authorize="isAuthenticated()">쪽지함으로 이동</a>
    </div>
</div>


<!-- 팔로우 요청 알림 표시 영역 -->
<!--<h2>* 팔로우 요청 알림 테스트</h2>-->
<!-- 전체 사용자 목록으로 이동하는 링크 -->
<!-- sec:authorize 속성을 올바르게 수정 -->
<!--<p sec:authorize="isAuthenticated()"><a href="/allUsers">전체 사용자 목록</a></p>-->



</body>
</html>
